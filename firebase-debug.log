[debug] [2025-05-12T18:06:30.769Z] ----------------------------------------------------------------------
[debug] [2025-05-12T18:06:30.770Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\ASUS\AppData\Roaming\npm\node_modules\firebase-tools\lib\bin\firebase.js emulators:start --only functions
[debug] [2025-05-12T18:06:30.770Z] CLI Version:   14.3.1
[debug] [2025-05-12T18:06:30.771Z] Platform:      win32
[debug] [2025-05-12T18:06:30.771Z] Node Version:  v22.14.0
[debug] [2025-05-12T18:06:30.771Z] Time:          Mon May 12 2025 21:06:30 GMT+0300 (GMT+03:00)
[debug] [2025-05-12T18:06:30.771Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-05-12T18:06:30.772Z] >>> [apiv2][query] GET https://firebase-public.firebaseio.com/cli.json [none]
[debug] [2025-05-12T18:06:30.926Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-05-12T18:06:30.926Z] > authorizing via signed-in user (sadeksobeg@gmail.com)
[info] i  emulators: Starting emulators: functions {"metadata":{"emulator":{"name":"hub"},"message":"Starting emulators: functions"}}
[debug] [2025-05-12T18:06:30.933Z] [logging] Logging Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-05-12T18:06:30.933Z] assigned listening specs for emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400},{"address":"::1","family":"IPv6","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000},{"address":"::1","family":"IPv6","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}]},"metadata":{"message":"assigned listening specs for emulators"}}
[debug] [2025-05-12T18:06:30.936Z] [hub] writing locator at C:\Users\ASUS\AppData\Local\Temp\hub-waffer-1b16d.json
[debug] [2025-05-12T18:06:30.947Z] [functions] Functions Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-05-12T18:06:30.947Z] [eventarc] Eventarc Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-05-12T18:06:30.948Z] [tasks] Cloud Tasks Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-05-12T18:06:30.948Z] late-assigned ports for functions and eventarc emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400},{"address":"::1","family":"IPv6","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000},{"address":"::1","family":"IPv6","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}],"functions":[{"address":"127.0.0.1","family":"IPv4","port":5001}],"eventarc":[{"address":"127.0.0.1","family":"IPv4","port":9299}],"tasks":[{"address":"127.0.0.1","family":"IPv4","port":9499}]},"metadata":{"message":"late-assigned ports for functions and eventarc emulators"}}
[warn] !  functions: The following emulators are not running, calls to these services from the Functions emulator will affect production: apphosting, auth, firestore, database, hosting, pubsub, storage, dataconnect {"metadata":{"emulator":{"name":"functions"},"message":"The following emulators are not running, calls to these services from the Functions emulator will affect production: \u001b[1mapphosting, auth, firestore, database, hosting, pubsub, storage, dataconnect\u001b[22m"}}
[debug] [2025-05-12T18:06:30.958Z] defaultcredentials: writing to file C:\Users\ASUS\AppData\Roaming\firebase\sadeksobeg_gmail_com_application_default_credentials.json
[debug] [2025-05-12T18:06:30.959Z] Setting GAC to C:\Users\ASUS\AppData\Roaming\firebase\sadeksobeg_gmail_com_application_default_credentials.json {"metadata":{"emulator":{"name":"functions"},"message":"Setting GAC to C:\\Users\\ASUS\\AppData\\Roaming\\firebase\\sadeksobeg_gmail_com_application_default_credentials.json"}}
[debug] [2025-05-12T18:06:30.960Z] Checked if tokens are valid: true, expires at: 1747076606674
[debug] [2025-05-12T18:06:30.960Z] Checked if tokens are valid: true, expires at: 1747076606674
[debug] [2025-05-12T18:06:30.960Z] >>> [apiv2][query] GET https://firebase.googleapis.com/v1beta1/projects/waffer-1b16d/adminSdkConfig [none]
[debug] [2025-05-12T18:06:31.317Z] *** [apiv2] error from fetch(https://firebase-public.firebaseio.com/cli.json, {"headers":{},"method":"GET"}): FetchError: request to https://firebase-public.firebaseio.com/cli.json failed, reason: Client network socket disconnected before secure TLS connection was established
[warn] !  Unable to fetch the CLI MOTD and remote config. This is not a fatal error, but may indicate an issue with your network connection. 
[debug] [2025-05-12T18:06:31.318Z] Failed to fetch MOTD FirebaseError: Failed to make request to https://firebase-public.firebaseio.com/cli.json
[debug] [2025-05-12T18:06:31.674Z] <<< [apiv2][status] GET https://firebase.googleapis.com/v1beta1/projects/waffer-1b16d/adminSdkConfig 403
[debug] [2025-05-12T18:06:31.674Z] <<< [apiv2][body] GET https://firebase.googleapis.com/v1beta1/projects/waffer-1b16d/adminSdkConfig "<!DOCTYPE html>\n<html lang=en>\n  <meta charset=utf-8>\n  <meta name=viewport content=\"initial-scale=1, minimum-scale=1, width=device-width\">\n  <title>Error 403 (Forbidden)!!1</title>\n  <style>\n    *{margin:0;padding:0}html,code{font:15px/22px arial,sans-serif}html{background:#fff;color:#222;padding:15px}body{margin:7% auto 0;max-width:390px;min-height:180px;padding:30px 0 15px}* > body{background:url(//www.google.com/images/errors/robot.png) 100% 5px no-repeat;padding-right:205px}p{margin:11px 0 22px;overflow:hidden}ins{color:#777;text-decoration:none}a img{border:0}@media screen and (max-width:772px){body{background:none;margin-top:0;max-width:none;padding-right:0}}#logo{background:url(//www.google.com/images/branding/googlelogo/1x/googlelogo_color_150x54dp.png) no-repeat;margin-left:-5px}@media only screen and (min-resolution:192dpi){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat 0% 0%/100% 100%;-moz-border-image:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) 0}}@media only screen and (-webkit-min-device-pixel-ratio:2){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat;-webkit-background-size:100% 100%}}#logo{display:inline-block;height:54px;width:150px}\n  </style>\n  <a href=//www.google.com/><span id=logo aria-label=Google></span></a>\n  <p><b>403.</b> <ins>That’s an error.</ins>\n  <p>Your client does not have permission to get URL <code>/v1beta1/projects/waffer-1b16d/adminSdkConfig</code> from this server.  <ins>That’s all we know.</ins>\n"
[debug] [2025-05-12T18:06:31.674Z] Failed to get Admin SDK config for waffer-1b16d, falling back to cache Failed to get Admin SDK for Firebase project waffer-1b16d. Please make sure the project exists and your account has permission to access it. {"name":"FirebaseError","children":[],"exit":2,"message":"Failed to get Admin SDK for Firebase project waffer-1b16d. Please make sure the project exists and your account has permission to access it.","original":{"name":"FirebaseError","children":[],"exit":1,"message":"Unable to parse JSON: SyntaxError: Unexpected token '<', \"<!DOCTYPE \"... is not valid JSON","status":500},"status":500}
[warn] !  functions: Unable to fetch project Admin SDK configuration, Admin SDK behavior in Cloud Functions emulator may be incorrect. {"metadata":{"emulator":{"name":"functions"},"message":"Unable to fetch project Admin SDK configuration, Admin SDK behavior in Cloud Functions emulator may be incorrect."}}
[info] i  functions: Watching "D:\waffer\project\functions" for Cloud Functions... {"metadata":{"emulator":{"name":"functions"},"message":"Watching \"D:\\waffer\\project\\functions\" for Cloud Functions..."}}
[debug] [2025-05-12T18:06:31.691Z] Validating nodejs source
[warn] !  functions: package.json indicates an outdated version of firebase-functions. Please upgrade using npm install --save firebase-functions@latest in your functions directory. 
[warn] !  functions: Please note that there will be breaking changes when you upgrade. 
[debug] [2025-05-12T18:06:33.335Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "firebase-admin": "^11.11.0",
    "firebase-functions": "^4.5.0",
    "firebase-functions-test": "^3.1.0",
    "cors": "^2.8.5",
    "express": "^4.18.2"
  },
  "devDependencies": {
    "typescript": "^5.3.2",
    "@types/cors": "^2.8.17",
    "@types/express": "^4.17.21",
    "@types/node": "^20.11.19"
  },
  "private": true
}
[debug] [2025-05-12T18:06:33.335Z] Building nodejs source
[debug] [2025-05-12T18:06:33.335Z] Failed to find version of module node: reached end of search path D:\waffer\project\functions\node_modules
[warn] !  functions: Your requested "node" version "18" doesn't match your global version "22". Using node@22 from host. 
[info] i  functions: You are using a version of firebase-functions SDK (4.9.0) that does not have support for the newest Firebase Extensions features. Please update firebase-functions SDK to >=5.1.0 to use them correctly 
[debug] [2025-05-12T18:06:33.338Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-05-12T18:06:33.342Z] Found firebase-functions binary at 'D:\waffer\project\functions\node_modules\.bin\firebase-functions'
[info] Serving at port 8526

[debug] [2025-05-12T18:06:33.666Z] Got response from /__/functions.yaml {"endpoints":{"api":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"httpsTrigger":{},"entryPoint":"api"},"onUserCreated":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"providers/firebase.auth/eventTypes/user.create","eventFilters":{"resource":"projects/waffer-1b16d"},"retry":false},"labels":{},"entryPoint":"onUserCreated"},"onCouponRedeemed":{"platform":"gcfv1","availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"serviceAccountEmail":null,"vpc":null,"eventTrigger":{"eventType":"providers/cloud.firestore/eventTypes/document.create","eventFilters":{"resource":"projects/waffer-1b16d/databases/(default)/documents/redemptions/{redemptionId}"},"retry":false},"labels":{},"entryPoint":"onCouponRedeemed"}},"specVersion":"v1alpha1","requiredAPIs":[]}
[info] +  functions: Loaded functions definitions from source: api, onUserCreated, onCouponRedeemed. {"metadata":{"emulator":{"name":"functions"},"message":"Loaded functions definitions from source: api, onUserCreated, onCouponRedeemed."}}
[info] +  functions[us-central1-api]: http function initialized (http://127.0.0.1:5001/waffer-1b16d/us-central1/api). {"metadata":{"emulator":{"name":"functions"},"message":"\u001b[1mhttp\u001b[22m function initialized (http://127.0.0.1:5001/waffer-1b16d/us-central1/api)."}}
[debug] [2025-05-12T18:06:37.690Z] addAuthTrigger {"eventTrigger":{"eventType":"providers/firebase.auth/eventTypes/user.create","resource":"projects/waffer-1b16d"}}
[info] +  functions[us-central1-onUserCreated]: auth function initialized. {"metadata":{"emulator":{"name":"functions"},"message":"\u001b[1mauth\u001b[22m function initialized."}}
[info] i  functions[us-central1-onCouponRedeemed]: function ignored because the firestore emulator does not exist or is not running. {"metadata":{"emulator":{"name":"functions"},"message":"function ignored because the firestore emulator does not exist or is not running."}}
[debug] [2025-05-12T18:06:37.693Z] Could not find VSCode notification endpoint: FetchError: request to http://localhost:40001/vscode/notify failed, reason: . If you are not running the Firebase Data Connect VSCode extension, this is expected and not an issue.
[info] 
┌─────────────────────────────────────────────────────────────┐
│ ✔  All emulators ready! It is now safe to connect your app. │
│ i  View Emulator UI at http://127.0.0.1:4000/               │
└─────────────────────────────────────────────────────────────┘

┌───────────┬────────────────┬─────────────────────────────────┐
│ Emulator  │ Host:Port      │ View in Emulator UI             │
├───────────┼────────────────┼─────────────────────────────────┤
│ Functions │ 127.0.0.1:5001 │ http://127.0.0.1:4000/functions │
└───────────┴────────────────┴─────────────────────────────────┘
  Emulator Hub host: 127.0.0.1 port: 4400
  Other reserved ports: 4500

Issues? Report them at https://github.com/firebase/firebase-tools/issues and attach the *-debug.log files.
 
[debug] [2025-05-12T18:10:08.382Z] ----------------------------------------------------------------------
[debug] [2025-05-12T18:10:08.384Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\ASUS\AppData\Roaming\npm\node_modules\firebase-tools\lib\bin\firebase.js emulators:start --only functions
[debug] [2025-05-12T18:10:08.385Z] CLI Version:   14.3.1
[debug] [2025-05-12T18:10:08.385Z] Platform:      win32
[debug] [2025-05-12T18:10:08.385Z] Node Version:  v22.14.0
[debug] [2025-05-12T18:10:08.385Z] Time:          Mon May 12 2025 21:10:08 GMT+0300 (GMT+03:00)
[debug] [2025-05-12T18:10:08.385Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-05-12T18:10:08.386Z] >>> [apiv2][query] GET https://firebase-public.firebaseio.com/cli.json [none]
[debug] [2025-05-12T18:10:08.542Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-05-12T18:10:08.542Z] > authorizing via signed-in user (sadeksobeg@gmail.com)
[info] i  emulators: Starting emulators: functions {"metadata":{"emulator":{"name":"hub"},"message":"Starting emulators: functions"}}
[debug] [2025-05-12T18:10:08.549Z] [logging] Logging Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-05-12T18:10:08.549Z] assigned listening specs for emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400},{"address":"::1","family":"IPv6","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000},{"address":"::1","family":"IPv6","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}]},"metadata":{"message":"assigned listening specs for emulators"}}
[warn] !  emulators: It seems that you are running multiple instances of the emulator suite for project waffer-1b16d. This may result in unexpected behavior. 
[debug] [2025-05-12T18:10:08.552Z] [hub] writing locator at C:\Users\ASUS\AppData\Local\Temp\hub-waffer-1b16d.json
[debug] [2025-05-12T18:10:08.564Z] [functions] Functions Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-05-12T18:10:08.564Z] [eventarc] Eventarc Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-05-12T18:10:08.564Z] [tasks] Cloud Tasks Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-05-12T18:10:08.564Z] late-assigned ports for functions and eventarc emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400},{"address":"::1","family":"IPv6","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000},{"address":"::1","family":"IPv6","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}],"functions":[{"address":"127.0.0.1","family":"IPv4","port":5001}],"eventarc":[{"address":"127.0.0.1","family":"IPv4","port":9299}],"tasks":[{"address":"127.0.0.1","family":"IPv4","port":9499}]},"metadata":{"message":"late-assigned ports for functions and eventarc emulators"}}
[warn] !  functions: The following emulators are not running, calls to these services from the Functions emulator will affect production: apphosting, auth, firestore, database, hosting, pubsub, storage, dataconnect {"metadata":{"emulator":{"name":"functions"},"message":"The following emulators are not running, calls to these services from the Functions emulator will affect production: \u001b[1mapphosting, auth, firestore, database, hosting, pubsub, storage, dataconnect\u001b[22m"}}
[debug] [2025-05-12T18:10:08.965Z] defaultcredentials: writing to file C:\Users\ASUS\AppData\Roaming\firebase\sadeksobeg_gmail_com_application_default_credentials.json
[debug] [2025-05-12T18:10:08.967Z] Setting GAC to C:\Users\ASUS\AppData\Roaming\firebase\sadeksobeg_gmail_com_application_default_credentials.json {"metadata":{"emulator":{"name":"functions"},"message":"Setting GAC to C:\\Users\\ASUS\\AppData\\Roaming\\firebase\\sadeksobeg_gmail_com_application_default_credentials.json"}}
[debug] [2025-05-12T18:10:08.967Z] Checked if tokens are valid: true, expires at: 1747076606674
[debug] [2025-05-12T18:10:08.967Z] Checked if tokens are valid: true, expires at: 1747076606674
[debug] [2025-05-12T18:10:08.967Z] >>> [apiv2][query] GET https://firebase.googleapis.com/v1beta1/projects/waffer-1b16d/adminSdkConfig [none]
[debug] [2025-05-12T18:10:09.815Z] *** [apiv2] error from fetch(https://firebase-public.firebaseio.com/cli.json, {"headers":{},"method":"GET"}): FetchError: request to https://firebase-public.firebaseio.com/cli.json failed, reason: Client network socket disconnected before secure TLS connection was established
[warn] !  Unable to fetch the CLI MOTD and remote config. This is not a fatal error, but may indicate an issue with your network connection. 
[debug] [2025-05-12T18:10:09.816Z] Failed to fetch MOTD FirebaseError: Failed to make request to https://firebase-public.firebaseio.com/cli.json
[debug] [2025-05-12T18:10:10.514Z] <<< [apiv2][status] GET https://firebase.googleapis.com/v1beta1/projects/waffer-1b16d/adminSdkConfig 403
[debug] [2025-05-12T18:10:10.514Z] <<< [apiv2][body] GET https://firebase.googleapis.com/v1beta1/projects/waffer-1b16d/adminSdkConfig "<!DOCTYPE html>\n<html lang=en>\n  <meta charset=utf-8>\n  <meta name=viewport content=\"initial-scale=1, minimum-scale=1, width=device-width\">\n  <title>Error 403 (Forbidden)!!1</title>\n  <style>\n    *{margin:0;padding:0}html,code{font:15px/22px arial,sans-serif}html{background:#fff;color:#222;padding:15px}body{margin:7% auto 0;max-width:390px;min-height:180px;padding:30px 0 15px}* > body{background:url(//www.google.com/images/errors/robot.png) 100% 5px no-repeat;padding-right:205px}p{margin:11px 0 22px;overflow:hidden}ins{color:#777;text-decoration:none}a img{border:0}@media screen and (max-width:772px){body{background:none;margin-top:0;max-width:none;padding-right:0}}#logo{background:url(//www.google.com/images/branding/googlelogo/1x/googlelogo_color_150x54dp.png) no-repeat;margin-left:-5px}@media only screen and (min-resolution:192dpi){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat 0% 0%/100% 100%;-moz-border-image:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) 0}}@media only screen and (-webkit-min-device-pixel-ratio:2){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat;-webkit-background-size:100% 100%}}#logo{display:inline-block;height:54px;width:150px}\n  </style>\n  <a href=//www.google.com/><span id=logo aria-label=Google></span></a>\n  <p><b>403.</b> <ins>That’s an error.</ins>\n  <p>Your client does not have permission to get URL <code>/v1beta1/projects/waffer-1b16d/adminSdkConfig</code> from this server.  <ins>That’s all we know.</ins>\n"
[debug] [2025-05-12T18:10:10.514Z] Failed to get Admin SDK config for waffer-1b16d, falling back to cache Failed to get Admin SDK for Firebase project waffer-1b16d. Please make sure the project exists and your account has permission to access it. {"name":"FirebaseError","children":[],"exit":2,"message":"Failed to get Admin SDK for Firebase project waffer-1b16d. Please make sure the project exists and your account has permission to access it.","original":{"name":"FirebaseError","children":[],"exit":1,"message":"Unable to parse JSON: SyntaxError: Unexpected token '<', \"<!DOCTYPE \"... is not valid JSON","status":500},"status":500}
[warn] !  functions: Unable to fetch project Admin SDK configuration, Admin SDK behavior in Cloud Functions emulator may be incorrect. {"metadata":{"emulator":{"name":"functions"},"message":"Unable to fetch project Admin SDK configuration, Admin SDK behavior in Cloud Functions emulator may be incorrect."}}
[info] i  functions: Watching "D:\waffer\project\functions" for Cloud Functions... {"metadata":{"emulator":{"name":"functions"},"message":"Watching \"D:\\waffer\\project\\functions\" for Cloud Functions..."}}
[debug] [2025-05-12T18:10:10.534Z] Validating nodejs source
[debug] [2025-05-12T18:10:12.454Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "cors": "^2.8.5",
    "express": "^4.18.2",
    "firebase-admin": "^11.11.0",
    "firebase-functions": "^6.3.2",
    "firebase-functions-test": "^3.1.0"
  },
  "devDependencies": {
    "@types/cors": "^2.8.17",
    "@types/express": "^4.17.21",
    "@types/node": "^20.11.19",
    "typescript": "^5.3.2"
  },
  "private": true
}
[debug] [2025-05-12T18:10:12.455Z] Building nodejs source
[debug] [2025-05-12T18:10:12.455Z] Failed to find version of module node: reached end of search path D:\waffer\project\functions\node_modules
[warn] !  functions: Your requested "node" version "18" doesn't match your global version "22". Using node@22 from host. 
[debug] [2025-05-12T18:10:12.457Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-05-12T18:10:12.461Z] Found firebase-functions binary at 'D:\waffer\project\functions\node_modules\.bin\firebase-functions'
[info] Serving at port 8739

[error] TypeError: Cannot read properties of undefined (reading 'user')
    at Object.<anonymous> (D:\waffer\project\functions\lib\index.js:138:40)
    at Module._compile (node:internal/modules/cjs/loader:1554:14)
    at Object..js (node:internal/modules/cjs/loader:1706:10)
    at Module.load (node:internal/modules/cjs/loader:1289:32)
    at Function._load (node:internal/modules/cjs/loader:1108:12)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:220:24)
    at Module.require (node:internal/modules/cjs/loader:1311:12)
    at require (node:internal/modules/helpers:136:16)
    at loadModule (D:\waffer\project\functions\node_modules\firebase-functions\lib\runtime\loader.js:40:16)

[debug] [2025-05-12T18:10:12.798Z] Got response code 400; body Failed to generate manifest from function source: TypeError: Cannot read properties of undefined (reading 'user')
[error] !!  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-05-12T18:10:16.832Z] Could not find VSCode notification endpoint: FetchError: request to http://localhost:40001/vscode/notify failed, reason: . If you are not running the Firebase Data Connect VSCode extension, this is expected and not an issue.
[info] 
┌─────────────────────────────────────────────────────────────┐
│ ✔  All emulators ready! It is now safe to connect your app. │
│ i  View Emulator UI at http://127.0.0.1:4000/               │
└─────────────────────────────────────────────────────────────┘

┌───────────┬────────────────┬─────────────────────────────────┐
│ Emulator  │ Host:Port      │ View in Emulator UI             │
├───────────┼────────────────┼─────────────────────────────────┤
│ Functions │ 127.0.0.1:5001 │ http://127.0.0.1:4000/functions │
└───────────┴────────────────┴─────────────────────────────────┘
  Emulator Hub host: 127.0.0.1 port: 4400
  Other reserved ports: 4500

Issues? Report them at https://github.com/firebase/firebase-tools/issues and attach the *-debug.log files.
 
[debug] [2025-05-12T18:11:18.400Z] ----------------------------------------------------------------------
[debug] [2025-05-12T18:11:18.402Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\ASUS\AppData\Roaming\npm\node_modules\firebase-tools\lib\bin\firebase.js emulators:start --only functions
[debug] [2025-05-12T18:11:18.403Z] CLI Version:   14.3.1
[debug] [2025-05-12T18:11:18.403Z] Platform:      win32
[debug] [2025-05-12T18:11:18.403Z] Node Version:  v22.14.0
[debug] [2025-05-12T18:11:18.403Z] Time:          Mon May 12 2025 21:11:18 GMT+0300 (GMT+03:00)
[debug] [2025-05-12T18:11:18.403Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-05-12T18:11:18.405Z] >>> [apiv2][query] GET https://firebase-public.firebaseio.com/cli.json [none]
[debug] [2025-05-12T18:11:18.565Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-05-12T18:11:18.565Z] > authorizing via signed-in user (sadeksobeg@gmail.com)
[info] i  emulators: Starting emulators: functions {"metadata":{"emulator":{"name":"hub"},"message":"Starting emulators: functions"}}
[debug] [2025-05-12T18:11:18.571Z] [logging] Logging Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-05-12T18:11:18.571Z] assigned listening specs for emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400},{"address":"::1","family":"IPv6","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000},{"address":"::1","family":"IPv6","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}]},"metadata":{"message":"assigned listening specs for emulators"}}
[warn] !  emulators: It seems that you are running multiple instances of the emulator suite for project waffer-1b16d. This may result in unexpected behavior. 
[debug] [2025-05-12T18:11:18.575Z] [hub] writing locator at C:\Users\ASUS\AppData\Local\Temp\hub-waffer-1b16d.json
[debug] [2025-05-12T18:11:18.586Z] [functions] Functions Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-05-12T18:11:18.586Z] [eventarc] Eventarc Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-05-12T18:11:18.586Z] [tasks] Cloud Tasks Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-05-12T18:11:18.586Z] late-assigned ports for functions and eventarc emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400},{"address":"::1","family":"IPv6","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000},{"address":"::1","family":"IPv6","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}],"functions":[{"address":"127.0.0.1","family":"IPv4","port":5001}],"eventarc":[{"address":"127.0.0.1","family":"IPv4","port":9299}],"tasks":[{"address":"127.0.0.1","family":"IPv4","port":9499}]},"metadata":{"message":"late-assigned ports for functions and eventarc emulators"}}
[warn] !  functions: The following emulators are not running, calls to these services from the Functions emulator will affect production: apphosting, auth, firestore, database, hosting, pubsub, storage, dataconnect {"metadata":{"emulator":{"name":"functions"},"message":"The following emulators are not running, calls to these services from the Functions emulator will affect production: \u001b[1mapphosting, auth, firestore, database, hosting, pubsub, storage, dataconnect\u001b[22m"}}
[debug] [2025-05-12T18:11:18.625Z] defaultcredentials: writing to file C:\Users\ASUS\AppData\Roaming\firebase\sadeksobeg_gmail_com_application_default_credentials.json
[debug] [2025-05-12T18:11:18.627Z] Setting GAC to C:\Users\ASUS\AppData\Roaming\firebase\sadeksobeg_gmail_com_application_default_credentials.json {"metadata":{"emulator":{"name":"functions"},"message":"Setting GAC to C:\\Users\\ASUS\\AppData\\Roaming\\firebase\\sadeksobeg_gmail_com_application_default_credentials.json"}}
[debug] [2025-05-12T18:11:18.628Z] Checked if tokens are valid: true, expires at: 1747076606674
[debug] [2025-05-12T18:11:18.628Z] Checked if tokens are valid: true, expires at: 1747076606674
[debug] [2025-05-12T18:11:18.628Z] >>> [apiv2][query] GET https://firebase.googleapis.com/v1beta1/projects/waffer-1b16d/adminSdkConfig [none]
[debug] [2025-05-12T18:11:19.231Z] *** [apiv2] error from fetch(https://firebase-public.firebaseio.com/cli.json, {"headers":{},"method":"GET"}): FetchError: request to https://firebase-public.firebaseio.com/cli.json failed, reason: Client network socket disconnected before secure TLS connection was established
[warn] !  Unable to fetch the CLI MOTD and remote config. This is not a fatal error, but may indicate an issue with your network connection. 
[debug] [2025-05-12T18:11:19.232Z] Failed to fetch MOTD FirebaseError: Failed to make request to https://firebase-public.firebaseio.com/cli.json
[debug] [2025-05-12T18:11:19.375Z] <<< [apiv2][status] GET https://firebase.googleapis.com/v1beta1/projects/waffer-1b16d/adminSdkConfig 403
[debug] [2025-05-12T18:11:19.375Z] <<< [apiv2][body] GET https://firebase.googleapis.com/v1beta1/projects/waffer-1b16d/adminSdkConfig "<!DOCTYPE html>\n<html lang=en>\n  <meta charset=utf-8>\n  <meta name=viewport content=\"initial-scale=1, minimum-scale=1, width=device-width\">\n  <title>Error 403 (Forbidden)!!1</title>\n  <style>\n    *{margin:0;padding:0}html,code{font:15px/22px arial,sans-serif}html{background:#fff;color:#222;padding:15px}body{margin:7% auto 0;max-width:390px;min-height:180px;padding:30px 0 15px}* > body{background:url(//www.google.com/images/errors/robot.png) 100% 5px no-repeat;padding-right:205px}p{margin:11px 0 22px;overflow:hidden}ins{color:#777;text-decoration:none}a img{border:0}@media screen and (max-width:772px){body{background:none;margin-top:0;max-width:none;padding-right:0}}#logo{background:url(//www.google.com/images/branding/googlelogo/1x/googlelogo_color_150x54dp.png) no-repeat;margin-left:-5px}@media only screen and (min-resolution:192dpi){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat 0% 0%/100% 100%;-moz-border-image:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) 0}}@media only screen and (-webkit-min-device-pixel-ratio:2){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat;-webkit-background-size:100% 100%}}#logo{display:inline-block;height:54px;width:150px}\n  </style>\n  <a href=//www.google.com/><span id=logo aria-label=Google></span></a>\n  <p><b>403.</b> <ins>That’s an error.</ins>\n  <p>Your client does not have permission to get URL <code>/v1beta1/projects/waffer-1b16d/adminSdkConfig</code> from this server.  <ins>That’s all we know.</ins>\n"
[debug] [2025-05-12T18:11:19.375Z] Failed to get Admin SDK config for waffer-1b16d, falling back to cache Failed to get Admin SDK for Firebase project waffer-1b16d. Please make sure the project exists and your account has permission to access it. {"name":"FirebaseError","children":[],"exit":2,"message":"Failed to get Admin SDK for Firebase project waffer-1b16d. Please make sure the project exists and your account has permission to access it.","original":{"name":"FirebaseError","children":[],"exit":1,"message":"Unable to parse JSON: SyntaxError: Unexpected token '<', \"<!DOCTYPE \"... is not valid JSON","status":500},"status":500}
[warn] !  functions: Unable to fetch project Admin SDK configuration, Admin SDK behavior in Cloud Functions emulator may be incorrect. {"metadata":{"emulator":{"name":"functions"},"message":"Unable to fetch project Admin SDK configuration, Admin SDK behavior in Cloud Functions emulator may be incorrect."}}
[info] i  functions: Watching "D:\waffer\project\functions" for Cloud Functions... {"metadata":{"emulator":{"name":"functions"},"message":"Watching \"D:\\waffer\\project\\functions\" for Cloud Functions..."}}
[debug] [2025-05-12T18:11:19.404Z] Validating nodejs source
[debug] [2025-05-12T18:11:21.800Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "cors": "^2.8.5",
    "express": "^4.18.2",
    "firebase-admin": "^11.11.0",
    "firebase-functions": "^6.3.2",
    "firebase-functions-test": "^3.1.0"
  },
  "devDependencies": {
    "@types/cors": "^2.8.17",
    "@types/express": "^4.17.21",
    "@types/node": "^20.11.19",
    "typescript": "^5.3.2"
  },
  "private": true
}
[debug] [2025-05-12T18:11:21.800Z] Building nodejs source
[debug] [2025-05-12T18:11:21.800Z] Failed to find version of module node: reached end of search path D:\waffer\project\functions\node_modules
[warn] !  functions: Your requested "node" version "18" doesn't match your global version "22". Using node@22 from host. 
[debug] [2025-05-12T18:11:21.802Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-05-12T18:11:21.806Z] Found firebase-functions binary at 'D:\waffer\project\functions\node_modules\.bin\firebase-functions'
[info] Serving at port 8704

[error] TypeError: Cannot read properties of undefined (reading 'user')
    at Object.<anonymous> (D:\waffer\project\functions\lib\index.js:138:40)
    at Module._compile (node:internal/modules/cjs/loader:1554:14)
    at Object..js (node:internal/modules/cjs/loader:1706:10)
    at Module.load (node:internal/modules/cjs/loader:1289:32)
    at Function._load (node:internal/modules/cjs/loader:1108:12)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:220:24)
    at Module.require (node:internal/modules/cjs/loader:1311:12)
    at require (node:internal/modules/helpers:136:16)
    at loadModule (D:\waffer\project\functions\node_modules\firebase-functions\lib\runtime\loader.js:40:16)

[debug] [2025-05-12T18:11:22.123Z] Got response code 400; body Failed to generate manifest from function source: TypeError: Cannot read properties of undefined (reading 'user')
[error] !!  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-05-12T18:11:26.147Z] Could not find VSCode notification endpoint: FetchError: request to http://localhost:40001/vscode/notify failed, reason: . If you are not running the Firebase Data Connect VSCode extension, this is expected and not an issue.
[info] 
┌─────────────────────────────────────────────────────────────┐
│ ✔  All emulators ready! It is now safe to connect your app. │
│ i  View Emulator UI at http://127.0.0.1:4000/               │
└─────────────────────────────────────────────────────────────┘

┌───────────┬────────────────┬─────────────────────────────────┐
│ Emulator  │ Host:Port      │ View in Emulator UI             │
├───────────┼────────────────┼─────────────────────────────────┤
│ Functions │ 127.0.0.1:5001 │ http://127.0.0.1:4000/functions │
└───────────┴────────────────┴─────────────────────────────────┘
  Emulator Hub host: 127.0.0.1 port: 4400
  Other reserved ports: 4500

Issues? Report them at https://github.com/firebase/firebase-tools/issues and attach the *-debug.log files.
 
[debug] [2025-05-12T18:18:38.987Z] ----------------------------------------------------------------------
[debug] [2025-05-12T18:18:38.988Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\ASUS\AppData\Roaming\npm\node_modules\firebase-tools\lib\bin\firebase.js emulators:start --only functions
[debug] [2025-05-12T18:18:38.989Z] CLI Version:   14.3.1
[debug] [2025-05-12T18:18:38.989Z] Platform:      win32
[debug] [2025-05-12T18:18:38.989Z] Node Version:  v22.14.0
[debug] [2025-05-12T18:18:38.989Z] Time:          Mon May 12 2025 21:18:38 GMT+0300 (GMT+03:00)
[debug] [2025-05-12T18:18:38.989Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-05-12T18:18:38.990Z] >>> [apiv2][query] GET https://firebase-public.firebaseio.com/cli.json [none]
[debug] [2025-05-12T18:18:39.141Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-05-12T18:18:39.141Z] > authorizing via signed-in user (sadeksobeg@gmail.com)
[info] i  emulators: Starting emulators: functions {"metadata":{"emulator":{"name":"hub"},"message":"Starting emulators: functions"}}
[debug] [2025-05-12T18:18:39.147Z] [logging] Logging Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-05-12T18:18:39.147Z] assigned listening specs for emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400},{"address":"::1","family":"IPv6","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000},{"address":"::1","family":"IPv6","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}]},"metadata":{"message":"assigned listening specs for emulators"}}
[warn] !  emulators: It seems that you are running multiple instances of the emulator suite for project waffer-1b16d. This may result in unexpected behavior. 
[debug] [2025-05-12T18:18:39.151Z] [hub] writing locator at C:\Users\ASUS\AppData\Local\Temp\hub-waffer-1b16d.json
[debug] [2025-05-12T18:18:39.161Z] [functions] Functions Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-05-12T18:18:39.161Z] [eventarc] Eventarc Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-05-12T18:18:39.162Z] [tasks] Cloud Tasks Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2025-05-12T18:18:39.162Z] late-assigned ports for functions and eventarc emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400},{"address":"::1","family":"IPv6","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000},{"address":"::1","family":"IPv6","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}],"functions":[{"address":"127.0.0.1","family":"IPv4","port":5001}],"eventarc":[{"address":"127.0.0.1","family":"IPv4","port":9299}],"tasks":[{"address":"127.0.0.1","family":"IPv4","port":9499}]},"metadata":{"message":"late-assigned ports for functions and eventarc emulators"}}
[warn] !  functions: The following emulators are not running, calls to these services from the Functions emulator will affect production: apphosting, auth, firestore, database, hosting, pubsub, storage, dataconnect {"metadata":{"emulator":{"name":"functions"},"message":"The following emulators are not running, calls to these services from the Functions emulator will affect production: \u001b[1mapphosting, auth, firestore, database, hosting, pubsub, storage, dataconnect\u001b[22m"}}
[debug] [2025-05-12T18:18:39.599Z] *** [apiv2] error from fetch(https://firebase-public.firebaseio.com/cli.json, {"headers":{},"method":"GET"}): FetchError: request to https://firebase-public.firebaseio.com/cli.json failed, reason: Client network socket disconnected before secure TLS connection was established
[warn] !  Unable to fetch the CLI MOTD and remote config. This is not a fatal error, but may indicate an issue with your network connection. 
[debug] [2025-05-12T18:18:39.600Z] Failed to fetch MOTD FirebaseError: Failed to make request to https://firebase-public.firebaseio.com/cli.json
[debug] [2025-05-12T18:18:40.537Z] defaultcredentials: writing to file C:\Users\ASUS\AppData\Roaming\firebase\sadeksobeg_gmail_com_application_default_credentials.json
[debug] [2025-05-12T18:18:40.539Z] Setting GAC to C:\Users\ASUS\AppData\Roaming\firebase\sadeksobeg_gmail_com_application_default_credentials.json {"metadata":{"emulator":{"name":"functions"},"message":"Setting GAC to C:\\Users\\ASUS\\AppData\\Roaming\\firebase\\sadeksobeg_gmail_com_application_default_credentials.json"}}
[debug] [2025-05-12T18:18:40.540Z] Checked if tokens are valid: true, expires at: 1747076606674
[debug] [2025-05-12T18:18:40.540Z] Checked if tokens are valid: true, expires at: 1747076606674
[debug] [2025-05-12T18:18:40.540Z] >>> [apiv2][query] GET https://firebase.googleapis.com/v1beta1/projects/waffer-1b16d/adminSdkConfig [none]
[debug] [2025-05-12T18:18:41.408Z] <<< [apiv2][status] GET https://firebase.googleapis.com/v1beta1/projects/waffer-1b16d/adminSdkConfig 403
[debug] [2025-05-12T18:18:41.409Z] <<< [apiv2][body] GET https://firebase.googleapis.com/v1beta1/projects/waffer-1b16d/adminSdkConfig "<!DOCTYPE html>\n<html lang=en>\n  <meta charset=utf-8>\n  <meta name=viewport content=\"initial-scale=1, minimum-scale=1, width=device-width\">\n  <title>Error 403 (Forbidden)!!1</title>\n  <style>\n    *{margin:0;padding:0}html,code{font:15px/22px arial,sans-serif}html{background:#fff;color:#222;padding:15px}body{margin:7% auto 0;max-width:390px;min-height:180px;padding:30px 0 15px}* > body{background:url(//www.google.com/images/errors/robot.png) 100% 5px no-repeat;padding-right:205px}p{margin:11px 0 22px;overflow:hidden}ins{color:#777;text-decoration:none}a img{border:0}@media screen and (max-width:772px){body{background:none;margin-top:0;max-width:none;padding-right:0}}#logo{background:url(//www.google.com/images/branding/googlelogo/1x/googlelogo_color_150x54dp.png) no-repeat;margin-left:-5px}@media only screen and (min-resolution:192dpi){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat 0% 0%/100% 100%;-moz-border-image:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) 0}}@media only screen and (-webkit-min-device-pixel-ratio:2){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat;-webkit-background-size:100% 100%}}#logo{display:inline-block;height:54px;width:150px}\n  </style>\n  <a href=//www.google.com/><span id=logo aria-label=Google></span></a>\n  <p><b>403.</b> <ins>That’s an error.</ins>\n  <p>Your client does not have permission to get URL <code>/v1beta1/projects/waffer-1b16d/adminSdkConfig</code> from this server.  <ins>That’s all we know.</ins>\n"
[debug] [2025-05-12T18:18:41.409Z] Failed to get Admin SDK config for waffer-1b16d, falling back to cache Failed to get Admin SDK for Firebase project waffer-1b16d. Please make sure the project exists and your account has permission to access it. {"name":"FirebaseError","children":[],"exit":2,"message":"Failed to get Admin SDK for Firebase project waffer-1b16d. Please make sure the project exists and your account has permission to access it.","original":{"name":"FirebaseError","children":[],"exit":1,"message":"Unable to parse JSON: SyntaxError: Unexpected token '<', \"<!DOCTYPE \"... is not valid JSON","status":500},"status":500}
[warn] !  functions: Unable to fetch project Admin SDK configuration, Admin SDK behavior in Cloud Functions emulator may be incorrect. {"metadata":{"emulator":{"name":"functions"},"message":"Unable to fetch project Admin SDK configuration, Admin SDK behavior in Cloud Functions emulator may be incorrect."}}
[info] i  functions: Watching "D:\waffer\project\functions" for Cloud Functions... {"metadata":{"emulator":{"name":"functions"},"message":"Watching \"D:\\waffer\\project\\functions\" for Cloud Functions..."}}
[debug] [2025-05-12T18:18:41.436Z] Validating nodejs source
[debug] [2025-05-12T18:18:43.714Z] > [functions] package.json contents: {
  "name": "functions",
  "scripts": {
    "build": "tsc",
    "build:watch": "tsc --watch",
    "serve": "npm run build && firebase emulators:start --only functions",
    "shell": "npm run build && firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "lib/index.js",
  "dependencies": {
    "cors": "^2.8.5",
    "express": "^4.18.2",
    "firebase-admin": "^11.11.0",
    "firebase-functions": "^6.3.2",
    "firebase-functions-test": "^3.1.0"
  },
  "devDependencies": {
    "@types/cors": "^2.8.17",
    "@types/express": "^4.17.21",
    "@types/node": "^20.11.19",
    "typescript": "^5.3.2"
  },
  "private": true
}
[debug] [2025-05-12T18:18:43.714Z] Building nodejs source
[debug] [2025-05-12T18:18:43.714Z] Failed to find version of module node: reached end of search path D:\waffer\project\functions\node_modules
[warn] !  functions: Your requested "node" version "18" doesn't match your global version "22". Using node@22 from host. 
[debug] [2025-05-12T18:18:43.716Z] Could not find functions.yaml. Must use http discovery
[debug] [2025-05-12T18:18:43.720Z] Found firebase-functions binary at 'D:\waffer\project\functions\node_modules\.bin\firebase-functions'
[info] Serving at port 8642

[error] TypeError: Cannot read properties of undefined (reading 'user')
    at Object.<anonymous> (D:\waffer\project\functions\lib\index.js:138:40)
    at Module._compile (node:internal/modules/cjs/loader:1554:14)
    at Object..js (node:internal/modules/cjs/loader:1706:10)
    at Module.load (node:internal/modules/cjs/loader:1289:32)
    at Function._load (node:internal/modules/cjs/loader:1108:12)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:220:24)
    at Module.require (node:internal/modules/cjs/loader:1311:12)
    at require (node:internal/modules/helpers:136:16)
    at loadModule (D:\waffer\project\functions\node_modules\firebase-functions\lib\runtime\loader.js:40:16)

[debug] [2025-05-12T18:18:44.039Z] Got response code 400; body Failed to generate manifest from function source: TypeError: Cannot read properties of undefined (reading 'user')
[error] !!  functions: Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Functions codebase could not be analyzed successfully. It may have a syntax or runtime error"}}
[debug] [2025-05-12T18:18:48.071Z] Could not find VSCode notification endpoint: FetchError: request to http://localhost:40001/vscode/notify failed, reason: . If you are not running the Firebase Data Connect VSCode extension, this is expected and not an issue.
[info] 
┌─────────────────────────────────────────────────────────────┐
│ ✔  All emulators ready! It is now safe to connect your app. │
│ i  View Emulator UI at http://127.0.0.1:4000/               │
└─────────────────────────────────────────────────────────────┘

┌───────────┬────────────────┬─────────────────────────────────┐
│ Emulator  │ Host:Port      │ View in Emulator UI             │
├───────────┼────────────────┼─────────────────────────────────┤
│ Functions │ 127.0.0.1:5001 │ http://127.0.0.1:4000/functions │
└───────────┴────────────────┴─────────────────────────────────┘
  Emulator Hub host: 127.0.0.1 port: 4400
  Other reserved ports: 4500

Issues? Report them at https://github.com/firebase/firebase-tools/issues and attach the *-debug.log files.
 
